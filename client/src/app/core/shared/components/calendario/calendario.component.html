<!-- HTML -->
<div class="dashboard-container">
  <!-- CARD 칔NICO DO CALEND츼RIO -->
  <mat-card class="calendario-card no-card-appearence">
    <!-- HEADER DO CARD -->
    <div class="card-header d-flex align-items-center justify-content-between p-3 border-bottom border-default">
      <div>
        <h2 class="calendario-titulo text-primary m-0 fw-bold">
          <mat-icon class="icon-destaque icon-header">event</mat-icon>
          Calend치rio de Agendamentos
        </h2>
        <p class="calendario-subtitulo text-secondary m-0">
          Gerencie hor치rios e disponibilidade
        </p>
      </div>
    </div>

    <!-- CONTE칔DO DO CARD -->
    <mat-card-content class="p-3">
      <!-- SELE칂츾O DE M칅S -->
      <div class="secao-meses mb-4">
        <h3 class="titulo-secao">Selecione o m칡s</h3>
        <mat-chip-listbox [(ngModel)]="mesSelecionado" (ngModelChange)="onMesChange($event)" aria-label="Sele칞칚o de m칡s" class="meses-chips">
          <mat-chip-option
            *ngFor="let mes of meses; let i = index"
            [value]="i"
            [selected]="i === mesSelecionado"
            class="mes-chip">
            {{ mes }}
          </mat-chip-option>
        </mat-chip-listbox>
      </div>

      <mat-divider class="mb-4"></mat-divider>

      <!-- CALEND츼RIO -->
      <div class="secao-calendario">
        <div class="d-flex justify-content-between">
          <h3 class="calendario-mes-titulo text-primary mb-3 fw-bold">
            <mat-icon class="icon-secundario icon-mes">calendar_month</mat-icon>
            {{ meses[mesSelecionado] }} {{ anoAtual }}
          </h3>
              <button mat-flat-button
                matTooltip="Gerar Hor치rios para {{meses[mesSelecionado]}} {{anoAtual}}"
                (click)="onGerarHorarios(mesSelecionado, anoAtual, $event)">
                <mat-icon>alarm</mat-icon>
                <span>Gerar hor치rios</span>

              </button>
        </div>
          <!-- Cabe칞alho dos dias da semana -->
        <div class="calendario-header">
          <div class="dia-semana-header" *ngFor="let dia of diasDaSemana">
            {{ dia }}
          </div>
        </div>

        <!-- Grade de dias -->
        <div class="calendario-grade">
          <div
            *ngFor="let dia of diasCalendario"
            class="dia-cell"
            [class.outro-mes]="!dia.mesAtual"
            [class.selecionado]="dia.numero === diaSelecionadoAtual && dia.mesAtual && !dia.fechado"
            [class.hoje]="ehHoje(dia)"
            [class.fechado]="dia.fechado && dia.mesAtual"
            [attr.title]="dia.fechado ? 'Dia fechado' : `${dia.dataCompleta.toLocaleDateString('pt-BR')}`"
            [matMenuTriggerFor]="menuAcoes"
            (click)="$event.stopPropagation()">

            <span class="numero-dia">{{ dia.numero }}</span>
            <span *ngIf="dia.fechado && dia.mesAtual" class="icone-fechado">游</span>

            <mat-menu #menuAcoes="matMenu" class="menu-calendario">
              <button
                mat-menu-item
                matTooltip="Visualizar Hor치rios de {{dia.dataCompleta.toLocaleDateString('pt-br')}}"
                (click)="onVisualizarHorarios(dia.dataCompleta, $event)">
                <mat-icon>visibility</mat-icon>
                <span>Visualizar Hor치rios</span>
              </button>

              <mat-divider></mat-divider>

              <button
                *appHasPermission="Permission.EMPLOYEE_PERMISSION"
                mat-menu-item
                matTooltip="Gerar Hor치rios para {{dia.dataCompleta.toLocaleDateString('pt-br')}}">
                <mat-icon>alarm</mat-icon>
                <span>Gerar hor치rios</span>
              </button>

              <ng-container *ngIf="!dia.fechado && dia.mesAtual">
                <mat-divider></mat-divider>
                <button
                  *appHasPermission="Permission.ADMIN_PERMISSION"
                  mat-menu-item
                  class="menu-item-danger"
                  matTooltip="Fechar {{dia.dataCompleta.toLocaleDateString('pt-br')}}"
                  (click)="fecharData(dia.dataCompleta); $event.stopPropagation()">
                  <mat-icon>block</mat-icon>
                  <span>Fechar data</span>
                </button>
              </ng-container>

              <ng-container *ngIf="dia.fechado && dia.mesAtual">
                <mat-divider></mat-divider>
                <button
                  mat-menu-item
                  *appHasPermission="Permission.ADMIN_PERMISSION"
                  class="menu-item-success"
                  matTooltip="Abrir {{dia.dataCompleta.toLocaleDateString('pt-br')}}"
                  (click)="abrirData(dia.dataCompleta); $event.stopPropagation()">
                  <mat-icon>check_circle</mat-icon>
                  <span>Abrir data</span>
                </button>
              </ng-container>
            </mat-menu>
          </div>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
</div>

