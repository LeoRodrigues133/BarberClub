<div class="filtro-chips-container">
  <!-- SeleÃ§Ã£o de MÃªs -->
  <div class="secao-meses">
    <h3 class="titulo-secao">Selecione o mÃªs</h3>
    <mat-chip-listbox [(ngModel)]="mesSelecionado" (ngModelChange)="onMesChange($event)" aria-label="SeleÃ§Ã£o de mÃªs">
      <mat-chip-option *ngFor="let mes of meses; let i = index" [value]="i" [selected]="i === mesSelecionado">
        {{ mes }}
      </mat-chip-option>
    </mat-chip-listbox>
  </div>

  <!-- Grade de CalendÃ¡rio -->
  <div class="secao-calendario">
    <h3 class="titulo-secao">{{ meses[mesSelecionado] }} {{ anoAtual }}</h3>

    <!-- CabeÃ§alho dos dias da semana -->
    <div class="calendario-header">
      <div class="dia-semana-header" *ngFor="let dia of diasDaSemana">
        {{ dia }}
      </div>
    </div>

    <!-- Grade de dias -->
    <div class="calendario-grade">
      <div *ngFor="let dia of diasCalendario" class="dia-cell" [class.outro-mes]="!dia.mesAtual"
        [class.selecionado]="dia.numero === diaSelecionadoAtual && dia.mesAtual && !dia.fechado"
        [class.hoje]="ehHoje(dia)" [class.fechado]="dia.fechado && dia.mesAtual"
        [attr.title]="dia.fechado ? 'Dia fechado' : ''" (click)="onDiaClick(dia)">

        <span class="numero-dia">{{ dia.numero }}</span>

        <span class="position-absolute top-0 mt-2 w-100">
          <!-- BotÃ£o de MAIS AÃ‡Ã•ES para dias abertos -->
          <button mat-mini-fab matTooltip="Mais AÃ§Ãµes" [matMenuTriggerFor]="menuAcoes" class="float-start mx-2"
            (click)="$event.stopPropagation()">
            <mat-icon>more_vert</mat-icon>
          </button>

          <mat-menu #menuAcoes="matMenu">

            <button mat-menu-item (click)="onVisualizarHorarios(dia.dataCompleta, $event)"
              matTooltip="visualizar {{dia.dataCompleta}}">
              <mat-icon>visibility</mat-icon>
              <span>Visualizar HorÃ¡rios</span>
            </button>

            <mat-divider></mat-divider>

            <button *appHasPermission="Permission.EMPLOYEE_PERMISSION" mat-menu-item
              (click)="onGerarHorarios(dia.dataCompleta, $event)">
              <mat-icon>alarm</mat-icon>
              <span>Gerar horÃ¡rios</span>
            </button>

            <ng-container *ngIf="!dia.fechado && dia.mesAtual">
              <button *appHasPermission="Permission.ADMIN_PERMISSION" mat-menu-item
                (click)="fecharData(dia.dataCompleta); $event.stopPropagation()">
                <mat-icon>block</mat-icon>
                <span>Fechar data</span>
              </button>
            </ng-container>

            <ng-container *ngIf="dia.fechado && dia.mesAtual">
              <button mat-menu-item *appHasPermission="Permission.ADMIN_PERMISSION"
                (click)="abrirData(dia.dataCompleta); $event.stopPropagation()">
                <mat-icon>check</mat-icon>
                <span>Abrir data</span>

              </button>
            </ng-container>
          </mat-menu>

          <!-- BotÃ£o para ABRIR data (quando estÃ¡ fechada) -->

        </span>

        <span *ngIf="dia.fechado && dia.mesAtual" class="icone-fechado">ðŸ”’</span>
      </div>
    </div>
  </div>
</div>
